---
layout: post
title:  bind address
date: 2015-05-30
---

今天讲这个事情困扰自己挺长时间了，总是想着要搞明白，但是也一直没腾出手来。今天真是闲的无聊就顺便学习了下。

是一个什么问题呢？就是在网络变成的`bind`调用中，如果是`IP`层的相关协议，那么是一定需要传入需要绑定的地址的。当然了，之前自己遇到的时候也就是随便`INADDR_ANY`或者`0`什么的就过去了。就没去仔细想这个地址到底是什么含义呢？

当时自己想，给定需要绑定的端口地址，不就可以了么？为什么还需要给一个ip地址呢？

## 实践出真知

其实这个地址我们在大多数情况下是不用的。什么情况下有用呢？当主机有多块网卡的时候。因为一个机器有多块网卡，那么就会从不同的网段接来数据，不同的网段可能有不同的需求。所以这里就需要一种机制来保证，端口是对应哪个网段的。而`INADDR_ANY`的含义就是对任何网段这个端口都有效。如果`localhost`的话，那么就只能接收本地回环的数据包，从外部发送过来的包是没办法接收的。

## 代码

自己写了个echo server，基本上可以验证了这个思想。地址在[这里](https://github.com/imay/snippet/blob/master/bind/bind.c)。用telnet就可以链接。

在本地分别使用`127.0.0.1`以及本地的ip来启动，再用响应的地址来telnet就可以了。例如

	./a.out 127.0.0.1 2312
	
	telnet 127.0.0.1 2312
	
这样就能够连得通，但是如果用真实的ip地址链接就不行了。

## 总结

这么点事，其实早都应该搞定了，拖到了现在，还是自己懒呀